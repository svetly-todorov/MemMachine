{
  "openapi": "3.0.0",
  "info": {
    "title": "MemMachine Unified API",
    "version": "1.0.0",
    "description": "Unified API specification for the MemMachine memory system, detailing both standard RESTful endpoints for direct interaction and dedicated MCP Server endpoints optimized for LLM tool use."
  },
  "servers": [
    {
      "url": "http://localhost:8080/",
      "description": "The base path for all standard RESTful API endpoints."
    }
  ],
  "tags": [
    {
      "name": "RESTful APIs",
      "description": "Standard RESTful API endpoints, typically consumed directly by applications and front-end clients for general memory management."
    },
    {
      "name": "MCP Tools",
      "description": "MCP endpoints exposed as tools and resources, primarily for use with an LLM via the MCP server/FastMCP implementation."
    }
  ],
  "paths": {
    "/v1/memories": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Add Memories (Unified)",
        "description": "Retrieves the appropriate memory instance and adds the episode to **both** episodic and profile memory.",
        "operationId": "add_memory",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEpisode"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Memory added successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    },
    "/v1/memories/episodic": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Add Episodic Memory",
        "description": "Adds an episode to the short-term (session) and long-term (declarative) memory for a conversation context.",
        "operationId": "add_episodic_memory",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEpisode"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Episode added successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    },
    "/v1/memories/profile": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Add Profile Memory Message",
        "description": "Adds a message to the user's conversation history, asynchronously triggering a profile update and consolidation.",
        "operationId": "add_profile_memory_message",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddProfileMemoryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Message accepted for profile ingestion.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    },
    "/v1/memories/search": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Search Memories (Unified)",
        "description": "Searches across both episodic and profile memories for the most relevant context.",
        "operationId": "search_memory",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResult"
                }
              }
            }
          }
        }
      }
    },
    "/v1/memories/episodic/search": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Search Episodic Memory",
        "description": "Retrieves the most relevant contextual information from short-term and long-term memory for a given query.",
        "operationId": "search_episodic_memory",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Episodic search results.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResult"
                }
              }
            }
          }
        }
      }
    },
    "/v1/memories/profile/search": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Semantic Search Profile Memory",
        "description": "Performs a semantic search against the user's profile and returns relevant entries based on similarity and filters.",
        "operationId": "semantic_search_profile_memory",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProfileSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "List of profile entries matching the query.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProfileEntriesResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/sessions": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Get All Sessions",
        "description": "Retrieves metadata for all active memory sessions in the system.",
        "operationId": "get_all_sessions",
        "responses": {
          "200": {
            "description": "List of memory sessions.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AllSessionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/sessions/delete": {
      "post": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Delete Session Data",
        "description": "Deletes all associated data for a specific memory context (session, group, user) from both episodic and profile memory.",
        "operationId": "delete_session_data",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteDataRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Data deleted successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    },
    "/v1/users/{user_id}/sessions": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Get Sessions by User ID",
        "description": "Retrieves metadata for all active memory sessions associated with a given user ID.",
        "operationId": "get_sessions_by_user",
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The user ID to filter by."
          }
        ],
        "responses": {
          "200": {
            "description": "List of memory sessions.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AllSessionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/groups/{group_id}/sessions": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Get Sessions by Group ID",
        "description": "Retrieves metadata for all active memory sessions within a given group ID.",
        "operationId": "get_sessions_by_group",
        "parameters": [
          {
            "name": "group_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The group ID to filter by."
          }
        ],
        "responses": {
          "200": {
            "description": "List of memory sessions.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AllSessionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/agents/{agent_id}/sessions": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Get Sessions by Agent ID",
        "description": "Retrieves metadata for all active memory sessions involving a given agent ID.",
        "operationId": "get_sessions_by_agent",
        "parameters": [
          {
            "name": "agent_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The agent ID to filter by."
          }
        ],
        "responses": {
          "200": {
            "description": "List of memory sessions.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AllSessionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/metrics": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Prometheus Metrics Endpoint",
        "description": "Serves Prometheus format metrics for monitoring the memory system.",
        "operationId": "get_metrics",
        "responses": {
          "200": {
            "description": "Prometheus metrics data.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "RESTful APIs"
        ],
        "summary": "Health Check",
        "description": "Simple health check endpoint to verify the server is running.",
        "operationId": "health_check",
        "responses": {
          "200": {
            "description": "Server is healthy.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/episodic_memory_search": {
      "post": {
        "tags": [
          "MCP Tools"
        ],
        "summary": "Episodic Memory Search",
        "description": "TOOL: Exposed to the LLM to search a conversation's episodic memory for context, returning a structured summary and relevant episodes.",
        "operationId": "episodic_memory_search",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contextual information retrieved from episodic memory.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResult"
                }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/profile_memory_search": {
      "post": {
        "tags": [
          "MCP Tools"
        ],
        "summary": "Profile Memory Search",
        "description": "TOOL: Exposed to the LLM to semantically search the user's Profile Memory for known facts and biographical information.",
        "operationId": "profile_memory_search",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProfileSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile entries matching the semantic query.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProfileEntriesResponse"
                }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/unified_memory_search": {
      "post": {
        "tags": [
          "MCP Tools"
        ],
        "summary": "Unified Memory Search",
        "description": "TOOL: Exposed to the LLM to search across both Episodic (conversation) and Profile (facts) memories for the most relevant context.",
        "operationId": "unified_memory_search",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contextual information retrieved from unified memory.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResult"
                }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/add_memory_episode": {
      "post": {
        "tags": [
          "MCP Tools"
        ],
        "summary": "Add Memory Episode",
        "description": "TOOL: Exposed to the LLM to add a new event (e.g., thought, action, or summary) to both episodic and profile memory.",
        "operationId": "add_memory_episode_tool",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewEpisode"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Episode added successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/delete_session_data": {
      "post": {
        "tags": [
          "MCP Tools"
        ],
        "summary": "Delete Session Data",
        "description": "TOOL: Exposed to the LLM to completely delete all data (episodic and profile) associated with a given conversation context (session or group).",
        "operationId": "delete_session_data_tool",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteDataRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Data deletion request accepted.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationStatus"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SearchResult": {
        "title": "SearchResult",
        "type": "object",
        "description": "The result of a memory search operation.",
        "properties": {
          "context_string": {
            "type": "string",
            "description": "The final formatted string containing summarized context and episodes for the LLM."
          }
        },
        "required": [
          "context_string"
        ]
      },
      "SessionData": {
        "title": "SessionData",
        "type": "object",
        "description": "Input for identifying a memory session.",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "The ID of the user.",
            "default": ""
          },
          "session_id": {
            "type": "string",
            "description": "The unique session identifier.",
            "default": ""
          }
        },
        "required": [
          "user_id",
          "session_id"
        ]
      },
      "DeleteDataRequest": {
        "title": "DeleteDataRequest",
        "type": "object",
        "description": "Request body for deleting memory data associated with a context.",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "The unique session identifier.",
            "default": ""
          },
          "group_id": {
            "type": "string",
            "description": "The group identifier.",
            "default": ""
          }
        },
        "required": [
          "session_id"
        ]
      },
      "SearchQuery": {
        "title": "SearchQuery",
        "type": "object",
        "description": "Request body for a memory search.",
        "properties": {
          "query": {
            "type": "string",
            "description": "The search query string.",
            "default": ""
          },
          "user_id": {
            "type": "string",
            "description": "The ID of the user associated with the search.",
            "default": ""
          },
          "session_id": {
            "type": "string",
            "description": "The unique session identifier.",
            "default": ""
          },
          "limit": {
            "type": "integer",
            "format": "int32",
            "description": "The maximum number of episodes to return.",
            "default": 20,
            "nullable": true
          },
          "property_filter": {
            "type": "object",
            "description": "A dictionary of key-value pairs to filter declarative memory search results.",
            "nullable": true
          }
        },
        "required": [
          "query",
          "user_id",
          "session_id"
        ]
      },
      "NewEpisode": {
        "title": "NewEpisode",
        "type": "object",
        "description": "Request body for adding a new episode to memory.",
        "properties": {
          "producer_id": {
            "type": "string",
            "description": "The ID of the user or agent that created the episode.",
            "default": ""
          },
          "produced_for_id": {
            "type": "string",
            "description": "The ID of the intended recipient.",
            "default": ""
          },
          "episode_content": {
            "type": "string",
            "description": "The content of the episode (text string).",
            "default": ""
          },
          "episode_type": {
            "type": "string",
            "description": "The category of the episode (e.g., 'message', 'thought').",
            "default": "message"
          },
          "user_id": {
            "type": "string",
            "description": "The ID of the user associated with the episode.",
            "default": ""
          },
          "session_id": {
            "type": "string",
            "description": "The unique session identifier.",
            "default": ""
          },
          "group_id": {
            "type": "string",
            "description": "The group identifier.",
            "default": ""
          },
          "metadata": {
            "type": "object",
            "description": "Optional dictionary for custom, user-defined metadata.",
            "nullable": true
          }
        },
        "required": [
          "producer_id",
          "produced_for_id",
          "episode_content",
          "episode_type",
          "user_id",
          "session_id"
        ]
      },
      "OperationStatus": {
        "title": "OperationStatus",
        "type": "object",
        "description": "Generic response indicating the status of an asynchronous operation.",
        "properties": {
          "status": {
            "type": "string",
            "description": "The status of the operation (e.g., 'success', 'accepted', 'failure').",
            "example": "success"
          }
        },
        "required": [
          "status"
        ]
      },
      "MemorySession": {
        "title": "MemorySession",
        "type": "object",
        "description": "Metadata representing a single active memory session.",
        "properties": {
          "user_ids": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of user IDs associated with the session."
          },
          "session_id": {
            "type": "string",
            "description": "Unique session identifier."
          },
          "group_id": {
            "type": "string",
            "nullable": true,
            "description": "Optional group ID."
          },
          "agent_ids": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true,
            "description": "List of agent IDs associated with the session."
          }
        },
        "required": [
          "user_ids",
          "session_id"
        ]
      },
      "AllSessionsResponse": {
        "title": "AllSessionsResponse",
        "type": "object",
        "description": "Response model containing a list of all retrieved memory sessions.",
        "properties": {
          "sessions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MemorySession"
            },
            "description": "The list of session objects."
          }
        },
        "required": [
          "sessions"
        ]
      },
      "AddProfileMemoryRequest": {
        "title": "AddProfileMemoryRequest",
        "type": "object",
        "description": "Request body for adding a message to the profile memory system.",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "The ID of the user associated with the message.",
            "default": ""
          },
          "content": {
            "type": "string",
            "description": "The message content.",
            "default": ""
          },
          "metadata": {
            "type": "object",
            "description": "Optional dictionary for message metadata.",
            "nullable": true
          },
          "isolations": {
            "type": "object",
            "description": "Optional dictionary for data isolation filtering.",
            "nullable": true
          }
        },
        "required": [
          "user_id",
          "content"
        ]
      },
      "ProfileSearchRequest": {
        "title": "ProfileSearchRequest",
        "type": "object",
        "description": "Request body for performing a semantic search on a user's profile.",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "The ID of the user.",
            "default": ""
          },
          "query": {
            "type": "string",
            "description": "The search query string.",
            "default": ""
          },
          "k": {
            "type": "integer",
            "format": "int32",
            "description": "Maximum number of results to retrieve.",
            "default": 10
          },
          "min_cos": {
            "type": "number",
            "format": "float",
            "description": "Minimum cosine similarity score.",
            "default": -1.0
          },
          "max_range": {
            "type": "number",
            "format": "float",
            "description": "Maximum range for the result filter.",
            "default": 2.0
          },
          "max_std": {
            "type": "number",
            "format": "float",
            "description": "Maximum standard deviation for the result filter.",
            "default": 1.0
          },
          "isolations": {
            "type": "object",
            "description": "Dictionary for data isolation filtering.",
            "nullable": true
          }
        },
        "required": [
          "user_id",
          "query"
        ]
      },
      "ProfileEntriesResponse": {
        "title": "ProfileEntriesResponse",
        "type": "object",
        "description": "Response model containing a list of profile entries.",
        "properties": {
          "entries": {
            "type": "array",
            "items": {
              "type": "object",
              "description": "A single profile entry (details omitted for brevity)."
            },
            "description": "The list of profile entries."
          }
        },
        "required": [
          "entries"
        ]
      }
    }
  }
}